<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
<meta charset="UTF-8">
<title>文章內頁</title>
<link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.1/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-F3w7mX95PdgyTmZZMECAngseQB83DfGTowi0iMjiWaeVhAn4FJkqJByhZMI3AhiU" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/sweetalert2@11/dist/sweetalert2.min.css">
<style>
.test {
	display: flex;
	flex-direction: column;
	min-height: 100vh;
	background-color: black;
	color: #333333;
	padding-bottom: 30px;
}

.card-header {
	background-color: #FFFFFF;
}

.card-body {
	background-color: #F9F9F9;
}

.article-title {
	color: #000000;
}

.card-footer {
	background-color: #FFFFFF;
}

.pagination {
	margin-top: 20px;
	text-align: center;
}

.pagination .page-item.disabled .page-link {
	color: #AAAAAA;
	background-color: #FFFFFF;
	border-color: #AAAAAA;
}

.pagination .page-link {
	color: #000000;
	background-color: #FFFFFF;
	border-color: #DDDDDD;
}

.pagination .page-link:hover {
	color: #000000;
	background-color: #F2F2F2;
	border-color: #DDDDDD;
}

.comment-card {
	margin-bottom: 20px;
}

.comment-card .card-header {
	background-color: #FFFFFF;
}

.comment-card .card-body {
	background-color: #F9F9F9;
}

.comment-card img {
	max-width: 200px;
}

.comment-actions {
	display: flex;
	justify-content: space-between;
	align-items: center;
}

.comment-actions button {
	margin-left: 10px;
}

.comment-pagination {
	margin-top: 20px;
	text-align: center;
}

.comment-pagination .page-item.disabled .page-link {
	color: #AAAAAA;
	background-color: #FFFFFF;
	border-color: #AAAAAA;
}

.comment-pagination .page-link {
	color: #000000;
	background-color: #FFFFFF;
	border-color: #DDDDDD;
}

.comment-pagination .page-link:hover {
	color: #000000;
	background-color: #F2F2F2;
	border-color: #DDDDDD;
}
</style>
<!-- CSS only -->
</head>
<body class="test">
	<div th:replace="~{layout/front_nav}"></div>
	
	<h2 style="color: white; padding-top: 100px;">文章內頁</h2>
	
	
	<!--  -->
	<div class="card" style="margin-top: 20px;">
    <div class="card-header" style="color: black">
		<h2 >
		<a th:href="@{/front/{articleId}(articleId=${article.articleId})}"
				th:text="${article}?${article.articleTitle}" class="link-dark"></a>
		</h2> <!-- <p>By <span th:text="${article.author}"></span></p> -->
		發文時間<span th:text="${article}?${#dates.format(article.articleTime,'yyyy-MM-dd, HH:mm:ss')}">發文時間</span>
		<br/>
		最新編輯時間<span th:text="${article}?${#dates.format(article.articleUpdateTime,'yyyy-MM-dd, HH:mm:ss')}">最新編輯時間</span>
    </div>
    
    <div class="card-body">
				<section style="color: black">
						<div ><input type="hidden" id="articleId" th:value="${article.articleId}"></div>
							<div th:text="${article}?${'#'+ article.articleType}"></div>
							<hr>
							<div th:text="${article}?${article.articleContent}">文章內容</div>
							<hr>
							<div>
								<img width="200px"
									th:src="@{'/downloadImage/'+${article.articleId}}">
							</div>
							
						<!-- 	<div class="edit-place" style="display: flex">  -->
							<div class="d-flex ">
						    <!-- 修改文章(跳頁) -->
						  
						        <form th:action="@{/front/articleEdit}" method="get">
						            <!-- 雖然藏起來但是參數有跟著送過去 -->
						            <input name="articleId" th:value="${article.articleId}" type="hidden"/>
						            <input type="submit" value="編輯文章" class="btn btn-outline-success btn-sm"/>
						        </form>
						    
						
						    <!-- 刪除文章(假刪除) -->
						    
						        <form th:action="@{'/front/article/delete/' + ${article.articleId}}" method="post" class="deleteForm5">
						            <button type="submit" class="btn btn-outline-danger btn-sm deleteButton5">刪除文章</button>
						        </form>
						  </div>
						 
						</section>
				   </div>
			 </div>
			
			<!-- 新增留言 -->
	<!-- <form th:action="@{/front/insert}" method="post"
						enctype="multipart/form-data">
	<button type="button" class="btn btn-outline-success" data-bs-toggle="modal"
		data-bs-target="#commentModal">新增留言</button></form>    -->
		
		<br/>
	<div>
	<form th:action="@{/front/{articleId}/insertCommentPage(articleId=${article.articleId})}" method="get"
    enctype="multipart/form-data">
	<button type="submit" class="btn btn-outline-warning">新增留言</button></form>
	</div>
	<!-- 顯示留言 -->
	<h2 style="color: white">Comments</h2>
	<div th:text="${'共 ' + totalComments + ' 筆留言'}" style="color: white"></div>
	<th:block th:each="comment,commentIndex : ${comments}"  style="color:black;">
	<div class="card"  style="color:black;">
    <div class="card-header" style="color:black;">
    <!-- 顯示留言者的名稱 --> <!-- <p th:text="${comment.userName}"></p>--commentIndex.count> <!-- 顯示留言的編號 -->
    	<div></div>
    	<div th:text="${'B'+  (commentIndex.index + 1 + (currentPage - 1) * pageSize)  }"></div>
    	留言時間<span th:text="${comment}?${#dates.format(comment.commentTime,'yyyy-MM-dd, HH:mm:ss')}"></span> <!-- 顯示留言的更新時間 -->
	<!--	更新留言時間<div th:text="${comment}?${#dates.format(comment.commentUpdateTime,'yyyy-MM-dd, HH:mm:ss')}"></div>--> 
     </div>
    <div class="card-body" style="color:black;">
	<div id="commentList" style="color:black;">
			<span th:text="${comment.commentContent}"></span>
			<!-- th:if="${comment.commentUpdateTime != null}" -->
			<!--<p th:if="${comment.commentUpdateTime == null}">未更新</p> -->  <!-- 如果有圖片，顯示圖片 -->
			<!-- 	<img th:if="${comment.commentImg != null}" th:src="@{'data:image/png;base64,'+${T(org.apache.tomcat.util.codec.binary.Base64).encodeBase64String(comment.commentImg)}}" /> -->
			<br/>
			<hr>
			<img width="200px" th:src="@{'/front/comments/'+${comment.commentId}}">
			<div class="d-flex ">
			<form th:action="@{/front/comments/edit}" method="get" enctype="multipart/form-data">
			<!-- 雖然藏起來但是參數有跟著送過去 -->
			<input name="commentId" th:value="${comment.commentId}" type="hidden"/>
			<input type="hidden" name="articleId" th:value="${article.articleId}" />
			 <button type="submit" value="編輯留言" class="btn btn-outline-success btn-sm">編輯留言</button>
			</form>
			<!-- 假刪除 -->	
			<form th:action="@{/front/{articleId}/comment/delete(articleId=${article.articleId})}" method="post" class="deleteForm">
			    <input name="articleId" th:value="${article.articleId}" type="hidden"/>
			    <input name="commentId" th:value="${comment.commentId}" type="hidden"/>
			    <button type="submit" class="btn btn-outline-danger btn-sm deleteButton"  id="deleteButton">刪除留言</button>
			</form>
		  </div>
		  </div>
	 </div>
  </div>
 		<br/>
 		<br/>
  </th:block>
  
  
  
<div class="pagination">
	<ul class="pagination">

		<!-- 往前一頁 -->
		<th:block th:switch="${comments.number == 0}">
			<li th:case="${true}" class="page-item disabled">
				<span class="page-link" aria-label="Previous"> 
					<span aria-hidden="true" style="user-select: none">這是第一頁</span>
				</span>
			</li>

			<li th:case="${false}" class="page-item">
				<a class="page-link" th:href="@{'/front/'+${article.articleId}+'?p='+${comments.number}}" aria-label="Previous">
					<span aria-hidden="true">&laquo;</span>
				</a>
			</li>
		</th:block>

		<!-- 中間每一頁 -->
		<th:block th:each="pageNumber : ${#numbers.sequence(1, comments.totalPages)}">
			<th:block th:switch="${comments.number != pageNumber-1}">
				<li th:case="${true}" class="page-item">
					<a class="page-link" th:href="@{'/front/'+${article.articleId}+'?p='+${pageNumber}}">
						[[${pageNumber}]]
					</a>
				</li>
						
				<li th:case="${false}" class="page-item active">
					<span class="page-link" th:text="${pageNumber}"></span>
				</li>
			</th:block>
		</th:block>

		<!-- 往後一頁 -->
		<th:block th:switch="${comments.number == comments.totalPages-1}">
			<li th:case="${true}" class="page-item disabled">
				<span class="page-link" aria-label="Next"> 
					<span aria-hidden="true">最後一頁了哦</span>
				</span>
			</li>
				
			<li th:case="${false}" class="page-item">
				<a class="page-link" th:href="@{'/front/'+${article.articleId}+'?p='+(comments.number + 2)}" aria-label="Next">
					<span aria-hidden="true">&raquo;</span>
				</a>
			</li>
		</th:block>

	</ul>
</div>





	<!-- 新增留言的Modal -->
<!-- 	<div class="modal fade" id="commentModal" tabindex="-1"
		aria-labelledby="commentModalLabel" aria-hidden="true">
		<div class="modal-dialog">
			<div class="modal-content">
				<div class="modal-header">
					<h5 class="modal-title" id="commentModalLabel">新增留言</h5>
					<button type="button" class="btn-close" data-bs-dismiss="modal"
						aria-label="Close"></button>
				</div>
				<div class="modal-body">
					<form id="commentForm">
						<div class="mb-3">
							<label for="commentContent" class="form-label">留言内容</label>
							<textarea class="form-control" id="commentContent" rows="3" required></textarea>
						</div>
					    <div class="mb-3" style="color: black">
						 <label for="commentImg" class="t1">照片</label>
                             <input type="file" name="commentImg" id="commentImg5"> 
                        </div>
					</form>
				</div>

				<div class="modal-footer">
					<button type="button" class="btn btn-secondary"
						data-bs-dismiss="modal">關閉</button>
					<button type="button" class="btn btn-outline-success" id="submitComment">提交留言</button>
				</div>
			</div>
		</div>
	</div>    -->
	 
	
<!-- 更新留言的modal -->
<!--<div class="modal fade" id="updateCommentModal" tabindex="-1"
     aria-labelledby="updateCommentModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="updateCommentModalLabel">更新留言</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"
                        aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="updateCommentForm">
                    <input type="hidden" id="updateCommentId" />
                    <div class="mb-3">
                        <label for="updateCommentContent" class="form-label">新的留言內容</label>
                        <textarea class="form-control" id="updateCommentContent" rows="3" required></textarea>
                    </div>
                    <div class="mb-3" style="color: black">
						 <label for="commentImg" class="t1">照片</label>
                         <input type="file" name="commentImg" id="commentImg"> 
                     </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary"
                        data-bs-dismiss="modal">關閉</button>
                <button type="button" class="btn btn-outline-success" id="submitUpdateComment">提交更新</button>
            </div>
        </div>
    </div>
</div>    -->
	
	
<div th:replace="~{layout/front_footer}"></div>
<script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
<script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
		
<script>
$(document).ready(function() {
        $('.deleteButton').on('click', function(e) {
            e.preventDefault();

            Swal.fire({
                title: '確定刪除?',
                text: "你將無法恢復此內容!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: '是的, 刪除!',
                cancelButtonText: '取消'
            }).then((result) => {
                if (result.isConfirmed) {
                    $('.deleteForm').submit();
                }
            })
        });
        
         $('.deleteButton5').on('click', function(e) {
            e.preventDefault();

            Swal.fire({
                title: '確定刪除?',
                text: "你將無法恢復此內容!",
                icon: 'warning',
                showCancelButton: true,
                confirmButtonColor: '#3085d6',
                cancelButtonColor: '#d33',
                confirmButtonText: '是的, 刪除!',
                cancelButtonText: '取消'
            }).then((result) => {
                if (result.isConfirmed) {
                    $('.deleteForm5').submit();
                }
            })
        });
        
        
        
    });
</script>

</body>
</html>
